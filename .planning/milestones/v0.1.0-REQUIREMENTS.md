# Requirements Archive: v0.1.0 CoGrid State Serialization

**Archived:** 2026-01-19
**Status:** SHIPPED

This is the archived requirements specification for v0.1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: CoGrid State Serialization

**Defined:** 2026-01-19
**Core Value:** Any environment state can be saved and restored with byte-perfect fidelity — the restored environment behaves identically to the original.

## v1 Requirements

### Framework

- [x] **FRAM-01**: Audit all GridObj subclasses and identify those missing `get_extra_state()`/`set_extra_state()`
- [x] **FRAM-02**: Implement recursive object serialization — objects holding other objects serialize their contents fully
- [x] **FRAM-03**: Document the serialization pattern for future object authors

### Overcooked Objects

- [x] **OVER-01**: Pot serializes cooking_tick, objects_in_pot (recursively), is_ready, is_cooking flags
- [x] **OVER-02**: Counter serializes object_on_counter with full object state
- [x] **OVER-03**: Plate serializes soup contents
- [x] **OVER-04**: Soup serializes ingredients list
- [x] **OVER-05**: OnionStack/TomatoStack serialize remaining count
- [x] **OVER-06**: DeliveryZone and other Overcooked objects audited and serialized as needed

### Search & Rescue Objects

- [x] **SRCH-01**: Victim objects (Green/Yellow/Red) serialize rescue state
- [x] **SRCH-02**: Rubble serializes cleared state
- [x] **SRCH-03**: Tools (MedKit, Pickaxe) serialize ownership/usage state
- [x] **SRCH-04**: All other S&R objects audited and serialized as needed

### Agent Serialization

- [x] **AGNT-01**: Agent inventory serializes held objects with full state (not just type)
- [x] **AGNT-02**: Domain-specific agent state (OvercookedAgent) serializes completely

### Environment Serialization

- [x] **ENVR-01**: Environment timestep (`t`) serializes and restores
- [x] **ENVR-02**: RNG state (`np_random`) serializes and restores for determinism
- [x] **ENVR-03**: Termination/truncation flags serialize and restore

### Testing

- [x] **TEST-01**: Roundtrip tests for each object type (create -> get_state -> set_state -> verify)
- [x] **TEST-02**: Full environment roundtrip test (run episode, checkpoint, restore, verify)
- [x] **TEST-03**: Determinism test (restored env produces identical trajectories)

## v2 Requirements

(None identified — scope is well-defined)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Rendering state serialization | Not needed for replay — pygame windows regenerated |
| Feature space caching | Regenerated on demand from grid state |
| Cross-version state migration | v1.0 states only need to work with v1.0 code |
| Goal Seeking environment | Lower priority domain, can add later if needed |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| FRAM-01 | Phase 1 - Framework Foundation | Complete |
| FRAM-02 | Phase 1 - Framework Foundation | Complete |
| FRAM-03 | Phase 1 - Framework Foundation | Complete |
| OVER-01 | Phase 2 - Overcooked Objects | Complete |
| OVER-02 | Phase 2 - Overcooked Objects | Complete |
| OVER-03 | Phase 2 - Overcooked Objects | Complete |
| OVER-04 | Phase 2 - Overcooked Objects | Complete |
| OVER-05 | Phase 2 - Overcooked Objects | Complete |
| OVER-06 | Phase 2 - Overcooked Objects | Complete |
| SRCH-01 | Phase 3 - Search & Rescue Objects | Complete |
| SRCH-02 | Phase 3 - Search & Rescue Objects | Complete |
| SRCH-03 | Phase 3 - Search & Rescue Objects | Complete |
| SRCH-04 | Phase 3 - Search & Rescue Objects | Complete |
| AGNT-01 | Phase 4 - Agent Serialization | Complete |
| AGNT-02 | Phase 4 - Agent Serialization | Complete |
| ENVR-01 | Phase 5 - Environment Serialization | Complete |
| ENVR-02 | Phase 5 - Environment Serialization | Complete |
| ENVR-03 | Phase 5 - Environment Serialization | Complete |
| TEST-01 | Phase 6 - Testing | Complete |
| TEST-02 | Phase 6 - Testing | Complete |
| TEST-03 | Phase 6 - Testing | Complete |

**Coverage:**
- v1 requirements: 21 total
- Shipped: 21
- Adjusted: 0
- Dropped: 0

---

## Milestone Summary

**Shipped:** 21 of 21 v1 requirements

**Adjusted:** None — all requirements implemented as originally specified

**Dropped:** None

**Notes:**
- Research discovered most serialization was already implemented (verification-only phases)
- RedVictim was the only object requiring new get_extra_state/set_extra_state implementation
- Door.encode() had a scope parameter bug that was fixed during testing phase
- 76 tests created to verify complete serialization coverage

---
*Archived: 2026-01-19 as part of v1.0 milestone completion*
