---
phase: 03-search-rescue-objects
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - cogrid/envs/search_rescue/test_sr_objects_serialization.py
autonomous: true

must_haves:
  truths:
    - "All 6 stateless S&R objects return None from get_extra_state()"
    - "All 6 stateless S&R objects roundtrip correctly via state integer"
    - "RedVictim serialization (Phase 1) is confirmed working"
    - "Audit script classifies all S&R objects correctly"
  artifacts:
    - path: "cogrid/envs/search_rescue/test_sr_objects_serialization.py"
      provides: "Roundtrip tests for all S&R objects"
      min_lines: 50
  key_links:
    - from: "test_sr_objects_serialization.py"
      to: "search_rescue_grid_objects.py"
      via: "imports S&R object classes"
      pattern: "from cogrid.envs.search_rescue.search_rescue_grid_objects import"
---

<objective>
Verify all Search & Rescue objects serialize correctly via comprehensive roundtrip tests.

Purpose: Research confirmed 6/7 S&R objects are stateless (no extra state to serialize) and RedVictim was already implemented in Phase 1. This plan verifies these findings with tests and confirms audit script classifications.

Output: Test file confirming SRCH-01 through SRCH-04 requirements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-search-rescue-objects/03-RESEARCH.md

# Prior work reference
@.planning/phases/01-framework-foundation/01-02-SUMMARY.md (RedVictim implementation)
@.planning/phases/02-overcooked-objects/02-01-SUMMARY.md (verification test pattern)

# Existing test patterns
@cogrid/envs/search_rescue/test_redvictim_serialization.py
@cogrid/envs/overcooked/test_state_serialization.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create S&R stateless objects roundtrip test file</name>
  <files>cogrid/envs/search_rescue/test_sr_objects_serialization.py</files>
  <action>
Create a new test file for Search & Rescue object serialization roundtrip tests.

Follow the parameterized test pattern from Phase 2 (test_state_serialization.py TestStatelessObjectsRoundtrip class).

Include:
1. Parameterized test for all 6 stateless objects (MedKit, Pickaxe, Rubble, GreenVictim, PurpleVictim, YellowVictim) confirming:
   - `get_extra_state()` returns None
   - `encode()` captures state integer
   - Roundtrip via constructor with state integer produces equivalent object

2. Test that RedVictim is NOT stateless (has extra state when toggle_countdown > 0 or first_toggle_agent is set) - this confirms Phase 1 implementation is necessary

3. Add docstrings explaining:
   - Why these objects are stateless (no internal mutable state beyond presence/absence on grid)
   - Reference to SRCH-01 through SRCH-04 requirements

Import from: `cogrid.envs.search_rescue.search_rescue_grid_objects`

Use pytest (not unittest) to match existing test_redvictim_serialization.py style.
  </action>
  <verify>
pytest cogrid/envs/search_rescue/test_sr_objects_serialization.py -v
All tests pass.
  </verify>
  <done>
- 6 parameterized tests confirm stateless objects return None from get_extra_state()
- 6 parameterized tests confirm stateless objects roundtrip via encode/constructor
- 1 test confirms RedVictim has extra state when in active rescue
- All tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify audit script classifications</name>
  <files>None (verification only)</files>
  <action>
Run the audit script and verify it correctly classifies all S&R objects:

```bash
python -m cogrid.scripts.audit_serialization
```

Expected output should show:
- MedKit: STATELESS
- Pickaxe: STATELESS
- Rubble: STATELESS
- GreenVictim: STATELESS
- PurpleVictim: STATELESS
- YellowVictim: STATELESS
- RedVictim: IMPLEMENTED

If any classification differs from expected, investigate and document the discrepancy in the summary. Do NOT modify the audit script - document findings only.

This confirms SRCH-04 (all S&R objects audited and serialized as needed).
  </action>
  <verify>
Audit script output matches expected classifications for all 7 S&R objects.
  </verify>
  <done>
Audit script correctly classifies all 7 S&R objects. Output captured in summary.
  </done>
</task>

<task type="auto">
  <name>Task 3: Run full S&R test suite and commit</name>
  <files>None (git operations only)</files>
  <action>
Run the complete Search & Rescue serialization test suite:

```bash
pytest cogrid/envs/search_rescue/test_redvictim_serialization.py cogrid/envs/search_rescue/test_sr_objects_serialization.py -v
```

Both test files should pass (Phase 1 RedVictim tests + new Phase 3 stateless object tests).

Then commit the new test file:

```bash
git add cogrid/envs/search_rescue/test_sr_objects_serialization.py
git commit -m "test(03-01): verify S&R stateless objects roundtrip correctly (SRCH-01/02/03/04)

Confirm all 6 stateless S&R objects (MedKit, Pickaxe, Rubble,
GreenVictim, PurpleVictim, YellowVictim) return None from
get_extra_state() and roundtrip via state integer.

RedVictim serialization was implemented in Phase 1 (01-02).

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```
  </action>
  <verify>
- All S&R serialization tests pass (7 from Phase 1 + new tests from this plan)
- Git commit created successfully
- `git log --oneline -1` shows the new commit
  </verify>
  <done>
- Full S&R serialization test suite passes
- New test file committed with descriptive message
- Requirements SRCH-01 through SRCH-04 verified
  </done>
</task>

</tasks>

<verification>
Phase 3 requirements verification:

| Requirement | Verification |
|-------------|--------------|
| SRCH-01: Victim objects serialize rescue state | Green/Purple/Yellow are stateless (no rescue state). RedVictim implemented in Phase 1. |
| SRCH-02: Rubble serializes cleared state | Cleared Rubble is removed from grid. Uncleared Rubble is stateless. |
| SRCH-03: Tools serialize ownership/usage state | MedKit/Pickaxe are stateless. Ownership tracked by Agent inventory (Phase 4). |
| SRCH-04: All S&R objects audited and serialized | All 7 objects analyzed. 6 stateless, 1 implemented. Audit script confirms. |
</verification>

<success_criteria>
1. New test file exists at cogrid/envs/search_rescue/test_sr_objects_serialization.py
2. All tests pass: pytest cogrid/envs/search_rescue/ -v
3. Audit script correctly classifies all 7 S&R objects
4. Git commit created with test file
5. Phase 3 requirements SRCH-01 through SRCH-04 verified as complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-search-rescue-objects/03-01-SUMMARY.md`
</output>
