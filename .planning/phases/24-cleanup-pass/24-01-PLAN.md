---
phase: 24-cleanup-pass
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - cogrid/cogrid_env.py
  - cogrid/constants.py
  - cogrid/test_overcooked_env.py
  - cogrid/run_interactive.py
  - cogrid/core/grid.py
  - cogrid/core/grid_object_base.py
  - cogrid/core/grid_objects.py
  - cogrid/core/grid_object_registry.py
  - cogrid/core/component_registry.py
  - cogrid/core/directions.py
  - cogrid/core/actions.py
  - cogrid/core/movement.py
  - cogrid/core/layout_parser.py
  - cogrid/core/agent.py
  - cogrid/core/step_pipeline.py
  - cogrid/core/interactions.py
  - cogrid/core/autowire.py
  - cogrid/core/grid_utils.py
  - cogrid/core/array_features.py
  - cogrid/core/array_rewards.py
  - cogrid/backend/env_state.py
  - cogrid/backend/state_view.py
  - cogrid/rendering/env_renderer.py
  - cogrid/visualization/rendering.py
  - cogrid/feature_space/array_features.py
  - cogrid/envs/overcooked/overcooked_grid_objects.py
  - cogrid/envs/overcooked/overcooked_array_features.py
  - cogrid/envs/overcooked/array_config.py
  - cogrid/envs/overcooked/test_interactions.py
  - cogrid/envs/search_rescue/search_rescue_grid_objects.py
  - cogrid/tests/test_autowire.py
  - cogrid/tests/test_phase14_validation.py
autonomous: true

must_haves:
  truths:
    - "grep -r 'TODO' --include='*.py' returns zero stale TODOs -- each remaining TODO has a clear action owner or is removed"
    - "No unused imports remain in production code (excluding re-export shims and intentional side-effect imports with noqa)"
    - "No commented-out code blocks remain"
    - "No stale PHASE2 comments remain"
    - "All 126+ tests still pass with zero modifications to test assertions"
  artifacts:
    - path: "cogrid/core/agent.py"
      provides: "Clean agent module with no stale PHASE2 comments or commented-out code"
    - path: "cogrid/core/grid_utils.py"
      provides: "Clean grid utils with no stale PHASE2 comment"
    - path: "cogrid/cogrid_env.py"
      provides: "Clean env with no unused imports"
  key_links:
    - from: "all modified files"
      to: "test suite"
      via: "pytest"
      pattern: "126 passed"
---

<objective>
Remove all stale TODOs, dead code (unused imports, commented-out code blocks, stale PHASE2 comments) from the entire codebase.

Purpose: Satisfy CLNP-01 (stale TODOs resolved) and CLNP-02 (dead code removed) from the Phase 24 requirements.
Output: Clean codebase with zero stale artifacts, all tests passing.
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Resolve stale TODOs, PHASE2 comments, and commented-out code</name>
  <files>
    cogrid/core/grid.py
    cogrid/core/grid_objects.py
    cogrid/core/grid_object_base.py
    cogrid/core/agent.py
    cogrid/core/grid_utils.py
    cogrid/test_overcooked_env.py
    cogrid/envs/overcooked/overcooked_grid_objects.py
    cogrid/run_interactive.py
  </files>
  <action>
    Resolve each TODO and stale comment. The goal is REMOVAL -- do not add new functionality.

    **TODOs to resolve (8 total):**

    1. `cogrid/test_overcooked_env.py:99` -- `TODO: how to set orientation and position of the agent?`
       Action: Remove the comment. This is a question, not an action item. The test works as-is.

    2. `cogrid/envs/overcooked/overcooked_grid_objects.py:165` -- `TODO(chase): assumes size 1 inventory`
       Action: Remove the comment. The inventory IS size 1 in the current design; this is documenting a known design constraint, not a bug.

    3. `cogrid/core/grid.py:75` -- `TODO(chase): Add the ability to pass an encoding.`
       Action: Remove. This is a feature idea, not relevant to current architecture (array-based encoding handles this).

    4. `cogrid/core/grid.py:370` -- `TODO(chase): Make efficiency improvements here.`
       Action: Remove. Rendering efficiency is not an active concern for v1.4.

    5. `cogrid/core/grid_objects.py:61` -- `TODO(chase): need to be able to initialize an object on top`
       Action: Remove. The array-based state handles object layering through object_type_map and object_state_map.

    6. `cogrid/core/grid_object_base.py:116` -- `TODO(chase): Remove. This used to be color, but we're no longer using it.`
       Action: Remove the TODO comment. Leave the `0` value in the encoding since changing it would alter array state (behavioral change). Just delete the comment text, keep the `0,`.

    7. `cogrid/core/grid_object_base.py:193` -- `TODO(chase): State must encapsulate carried objects and role`
       Action: Remove. Carried objects are handled via inventory arrays in the functional pipeline.

    8. `cogrid/core/agent.py:85` -- `TODO(chase): check that this is correct`
       Action: Remove. The code has been validated by 126+ passing tests across both backends.

    **Stale PHASE2 comments (3 total):**

    1. `cogrid/core/agent.py:114` -- `# PHASE2: DIR_VEC_TABLE will be a constant in the EnvState module`
       Action: Remove. Phase 2 is long complete; DIR_VEC_TABLE lives in agent.py and that's where it stays.

    2. `cogrid/core/agent.py:192` -- `# PHASE2: This function will be removed when Grid/Agent objects are replaced by EnvState`
       Action: Remove. sync_arrays_to_agents is still needed for the PettingZoo wrapper path.

    3. `cogrid/core/grid_utils.py:22` -- `# PHASE2: This function will operate on EnvState pytree instead of Grid object`
       Action: Remove. layout_to_array_state already operates on arrays; the comment is stale.

    **Commented-out code blocks to remove:**

    1. `cogrid/core/agent.py:59-68` -- 10 lines of commented-out old dir_to_vec list definition.
       Action: Delete the entire commented-out block (lines with `# dir_to_vec = [` through `# ]`).

    2. `cogrid/run_interactive.py:12-24` -- 12 lines of commented-out onnxruntime and scipy imports.
       Action: Delete both commented-out try/except blocks.

    3. `cogrid/run_interactive.py:144-145` -- 2 lines of commented-out onnx inference call.
       Action: Delete.

    4. `cogrid/run_interactive.py:181-183` -- 3 lines of commented-out print statement.
       Action: Delete.

    IMPORTANT: Do NOT modify any test assertions. Only remove comments and dead code.
  </action>
  <verify>
    Run: `grep -rn "TODO" --include="*.py" cogrid/` -- should return zero results.
    Run: `grep -rn "PHASE2" --include="*.py" cogrid/` -- should return zero results.
    Run: `python3 -m pytest cogrid/tests/ -x -q --tb=short` -- all tests pass.
  </verify>
  <done>Zero stale TODOs remain. Zero PHASE2 comments remain. No commented-out code blocks remain in the files listed. All tests pass unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Remove unused imports from all Python files</name>
  <files>
    cogrid/cogrid_env.py
    cogrid/constants.py
    cogrid/test_overcooked_env.py
    cogrid/run_interactive.py
    cogrid/visualization/rendering.py
    cogrid/core/grid.py
    cogrid/core/component_registry.py
    cogrid/core/directions.py
    cogrid/core/actions.py
    cogrid/core/movement.py
    cogrid/core/grid_objects.py
    cogrid/core/layout_parser.py
    cogrid/core/grid_object_base.py
    cogrid/core/step_pipeline.py
    cogrid/core/interactions.py
    cogrid/core/autowire.py
    cogrid/core/grid_object_registry.py
    cogrid/core/array_features.py
    cogrid/core/array_rewards.py
    cogrid/backend/env_state.py
    cogrid/backend/state_view.py
    cogrid/rendering/env_renderer.py
    cogrid/feature_space/array_features.py
    cogrid/envs/overcooked/overcooked_grid_objects.py
    cogrid/envs/overcooked/overcooked_array_features.py
    cogrid/envs/overcooked/array_config.py
    cogrid/envs/overcooked/test_interactions.py
    cogrid/envs/search_rescue/search_rescue_grid_objects.py
    cogrid/tests/test_autowire.py
    cogrid/tests/test_phase14_validation.py
  </files>
  <action>
    Remove unused imports from production and test files. Be precise about what is truly unused vs. intentional re-exports.

    **SKIP these categories (do NOT touch):**
    - `cogrid/core/grid_object.py` -- this is a re-export shim; all imports are intentional
    - Any `__init__.py` files -- re-exports for public API
    - Any import with `# noqa` comment -- intentional side-effect imports for registration
    - `cogrid/core/array_rewards.py` line 12 (`register_reward_type`) -- re-export with noqa
    - `cogrid/core/array_features.py` line 16 (`register_feature_type`) -- re-export with noqa

    **Production files -- remove these unused imports:**

    1. `cogrid/cogrid_env.py`:
       - Remove `import collections` (line 1)
       - Remove `from itertools import combinations` (line 2)
       - Remove `sync_arrays_to_agents` and `get_dir_vec_table` from line 28 import (keep `create_agent_arrays`)
       - Remove `from cogrid.core.movement import move_agents` (line 29) -- entire line
       - Remove duplicate `from cogrid.core import directions` (line 19 -- it's already imported on line 13)

    2. `cogrid/constants.py`:
       - Remove `import numpy as np` (line 3)

    3. `cogrid/visualization/rendering.py`:
       - Remove `from __future__ import annotations` (line 1, no type annotations in file)

    4. `cogrid/core/grid.py`:
       - Remove `from __future__ import annotations` (line 6) -- Python 3.11 handles annotations natively. BUT first check if file uses forward references. If it does, leave it. If it only uses `X | Y`, safe to remove since Python 3.11 supports that natively.
       - Remove `Callable` from `from typing import Any, Callable` (keep `Any`)
       - Remove `from cogrid.core import grid_object` (line 14)

    5. `cogrid/core/component_registry.py`:
       - Remove `from __future__ import annotations` ONLY if safe (check for forward refs first)

    6. `cogrid/core/directions.py`:
       - Remove `from __future__ import annotations` (no annotations in file)

    7. `cogrid/core/actions.py`:
       - Remove `from __future__ import annotations` (no annotations in file)

    8. `cogrid/core/movement.py`:
       - Remove `from __future__ import annotations` (no annotations in file)

    9. `cogrid/core/grid_objects.py`:
       - Remove `from __future__ import annotations` ONLY if safe (has annotations -- check for forward refs)

    10. `cogrid/core/layout_parser.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    11. `cogrid/core/grid_object_base.py`:
        - Remove `from __future__ import annotations` ONLY if safe
        - Remove `from cogrid.core.constants import Colors` (line 19) -- unused
        - Remove `from cogrid.core import constants` (line 20) -- unused
        - Remove `point_in_circle` from the rendering import (line 22) -- keep only what's used

    12. `cogrid/core/step_pipeline.py`:
        - Remove `from __future__ import annotations` (no annotations in file)

    13. `cogrid/core/interactions.py`:
        - Remove `from __future__ import annotations` (no annotations in file)

    14. `cogrid/core/autowire.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    15. `cogrid/core/grid_object_registry.py`:
        - Remove `from __future__ import annotations` ONLY if safe
        - Remove `from cogrid.constants import GridConstants` (line 12) -- unused

    16. `cogrid/backend/env_state.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    17. `cogrid/backend/state_view.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    18. `cogrid/rendering/env_renderer.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    19. `cogrid/envs/overcooked/overcooked_grid_objects.py`:
        - Remove `from __future__ import annotations` ONLY if safe
        - Remove `from copy import deepcopy` (line 2)
        - Remove `import math` (line 3)
        - Remove `from cogrid.constants import GridConstants` (line 7)
        - Remove `COLORS` from constants import (line 8, keep `ObjectColors`)
        - Remove `point_in_rect`, `point_in_triangle`, `rotate_fn` from rendering import (line 10, keep what's used)

    20. `cogrid/envs/overcooked/overcooked_array_features.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    21. `cogrid/envs/overcooked/array_config.py`:
        - Remove `from __future__ import annotations` ONLY if safe

    22. `cogrid/envs/search_rescue/search_rescue_grid_objects.py`:
        - Remove `from cogrid.constants import GridConstants` (line 3)
        - Remove `ObjectColors` and `COLORS` from constants import (line 5, keep what's used)

    23. `cogrid/feature_space/array_features.py`:
        - Remove `from __future__ import annotations` (no annotations in file)

    **Test files -- remove truly unused imports (NOT side-effect imports):**

    24. `cogrid/test_overcooked_env.py`:
        - Remove `import time` (line 2)
        - Remove `import numpy as np` (line 5)
        - Remove `from cogrid.core.directions import Directions` (line 7)
        - Remove `from cogrid.core import grid_object` (line 9)

    25. `cogrid/envs/overcooked/test_interactions.py`:
        - Remove `from __future__ import annotations` (line 10, no annotations)
        - Remove `import copy` (line 43)
        - Add `# noqa: F401` to `import cogrid.envs` if not already present (side-effect import)
        - Remove `from cogrid.envs import registry` (line 48)
        - Remove `get_object_names` from grid_object import (line 49, keep `build_lookup_tables` and `object_to_idx`)
        - Remove `from cogrid.core.grid_utils import layout_to_array_state` (line 50)
        - Remove `from cogrid.core.agent import create_agent_arrays, get_dir_vec_table` (line 51)
        - Remove `from cogrid.core import actions as grid_actions` (line 52)

    26. `cogrid/tests/test_autowire.py`:
        - Remove `import pytest` (line 20) -- unused

    27. `cogrid/tests/test_phase14_validation.py`:
        - Remove `gf` from import on line 195 if unused
        - Remove `examples` from import on line 245 if unused

    **IMPORTANT SAFETY RULES:**
    - For `from __future__ import annotations` in files that HAVE type annotations: only remove if you verify removing it does not cause import-time errors. Run `python3 -c "import cogrid.core.MODULE"` after each removal to verify. If it fails, revert.
    - For re-export files (`grid_object.py`, `__init__.py`): do NOT touch.
    - For side-effect imports (test files importing `cogrid.envs`): do NOT remove, but ensure they have `# noqa: F401`.
    - Run tests after completing all removals to confirm zero breakage.
  </action>
  <verify>
    Run the unused import detector script:
    ```python
    python3 -c "
    import ast, os
    for root, dirs, files in os.walk('cogrid'):
        dirs[:] = [d for d in dirs if d != '__pycache__']
        for f in files:
            if not f.endswith('.py'): continue
            fpath = os.path.join(root, f)
            if f == '__init__.py' or fpath == 'cogrid/core/grid_object.py': continue
            with open(fpath) as fh: source = fh.read()
            try: tree = ast.parse(source, fpath)
            except SyntaxError: continue
            imported = {}
            for node in ast.walk(tree):
                if isinstance(node, ast.Import):
                    for alias in node.names:
                        name = alias.asname or alias.name.split('.')[0]
                        imported[name] = (node.lineno, source.splitlines()[node.lineno-1])
                elif isinstance(node, ast.ImportFrom):
                    for alias in node.names:
                        if alias.name == '*': continue
                        name = alias.asname or alias.name
                        imported[name] = (node.lineno, source.splitlines()[node.lineno-1])
            used = set()
            for node in ast.walk(tree):
                if isinstance(node, ast.Name): used.add(node.id)
                elif isinstance(node, ast.Attribute):
                    if isinstance(node.value, ast.Name): used.add(node.value.id)
            for name, (lineno, line) in imported.items():
                if name not in used and name != '_' and not name.startswith('__') and 'noqa' not in line:
                    print(f'{fpath}:{lineno}: unused {name}')
    "
    ```
    Should return zero results (or only intentional re-exports).

    Run: `python3 -m pytest cogrid/tests/ -x -q --tb=short` -- all 126+ tests pass.
    Run: `python3 -m pytest cogrid/test_overcooked_env.py -x -q --tb=short` -- all 5 tests pass.
  </verify>
  <done>Zero unused imports remain in production code (excluding intentional re-exports with noqa). Zero unused `from __future__ import annotations` remain. All tests pass unchanged.</done>
</task>

</tasks>

<verification>
1. `grep -rn "TODO" --include="*.py" cogrid/` returns zero lines
2. `grep -rn "PHASE2" --include="*.py" cogrid/` returns zero lines
3. Unused import detector returns zero hits (excluding noqa lines)
4. `python3 -m pytest cogrid/tests/ cogrid/test_overcooked_env.py -q --tb=short` -- 131 tests pass
</verification>

<success_criteria>
- CLNP-01 satisfied: zero stale TODOs remain
- CLNP-02 partially satisfied: all dead code (unused imports, commented-out blocks, stale phase comments) removed
- CLNP-04 maintained: all tests pass without modification to assertions
</success_criteria>

<output>
After completion, create `.planning/phases/24-cleanup-pass/24-01-SUMMARY.md`
</output>
