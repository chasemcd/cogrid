---
phase: 24-cleanup-pass
plan: 02
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - cogrid/cogrid_env.py
  - cogrid/__init__.py
  - cogrid/visualization/rendering.py
  - cogrid/core/array_rewards.py
  - cogrid/core/array_features.py
  - cogrid/core/component_registry.py
  - cogrid/core/movement.py
  - cogrid/core/layout_parser.py
  - cogrid/core/agent.py
  - cogrid/core/step_pipeline.py
  - cogrid/core/interactions.py
  - cogrid/core/autowire.py
  - cogrid/core/grid_utils.py
  - cogrid/core/grid_object_registry.py
  - cogrid/backend/env_state.py
  - cogrid/backend/_dispatch.py
  - cogrid/envs/overcooked/array_config.py
  - cogrid/envs/overcooked/array_rewards.py
  - cogrid/feature_space/array_features.py
autonomous: true

must_haves:
  truths:
    - "No docstring in production code restates what the function signature already says"
    - "No boilerplate Args/Parameters/Returns sections exist that merely name parameters without adding information"
    - "Docstrings that explain non-obvious behavior, domain logic, or invariants are preserved"
    - "All 126+ tests still pass with zero modifications to test assertions"
  artifacts:
    - path: "cogrid/core/step_pipeline.py"
      provides: "Clean docstrings on step/reset/build_step_fn/build_reset_fn"
    - path: "cogrid/core/autowire.py"
      provides: "Clean docstrings on build_scope_config/build_reward_config/build_feature_config"
    - path: "cogrid/envs/overcooked/array_config.py"
      provides: "Clean docstrings on overcooked tick/interaction functions"
  key_links:
    - from: "all modified files"
      to: "test suite"
      via: "pytest"
      pattern: "126 passed"
---

<objective>
Trim all boilerplate docstrings across production code so every docstring adds information the code does not already convey.

Purpose: Satisfy CLNP-03 (docstrings trimmed to essential information) and run the final test suite to confirm CLNP-04 (zero behavioral changes).
Output: Concise docstrings throughout, full test parity confirmed.
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-cleanup-pass/24-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Trim boilerplate docstrings across production code</name>
  <files>
    cogrid/cogrid_env.py
    cogrid/__init__.py
    cogrid/visualization/rendering.py
    cogrid/core/array_rewards.py
    cogrid/core/array_features.py
    cogrid/core/component_registry.py
    cogrid/core/movement.py
    cogrid/core/layout_parser.py
    cogrid/core/agent.py
    cogrid/core/step_pipeline.py
    cogrid/core/interactions.py
    cogrid/core/autowire.py
    cogrid/core/grid_utils.py
    cogrid/core/grid_object_registry.py
    cogrid/backend/env_state.py
    cogrid/backend/_dispatch.py
    cogrid/envs/overcooked/array_config.py
    cogrid/envs/overcooked/array_rewards.py
    cogrid/feature_space/array_features.py
  </files>
  <action>
    Trim or remove boilerplate docstrings in 59 functions across 19 production files. The goal is: every docstring adds information the function signature does not already convey.

    **Rules for trimming:**

    1. **Remove Args/Parameters sections that merely restate parameter names and types.**
       Bad: `Args: state: the environment state dict` -- the signature already says `state: dict`
       Bad: `Args: n_agents: number of agents` -- obvious from the name
       Good: `Args: state: must contain 'pot_contents' and 'pot_timer' keys` -- non-obvious requirement
       Good: `Args: coefficient: multiplied with raw reward; set to 0 to disable` -- explains behavior

    2. **Remove Returns sections that just name the return type.**
       Bad: `Returns: ndarray of shape (n_agents,)` -- if the signature says `-> ndarray`
       Good: `Returns: (n_agents,) float32 rewards, positive for delivery, zero otherwise` -- explains semantics

    3. **Keep docstrings that explain WHY, WHEN, or INVARIANTS.**
       Keep: "Called once at init time; captures scope config in closure"
       Keep: "Must be called after set_backend() but before any array operations"
       Keep: "Returns positions of cells directly in front of each agent (row, col)"

    4. **Shorten verbose one-line descriptions.**
       Before: `"""Given logits sample an action via softmax."""`
       After: (leave as-is -- this is already concise)
       Before: `"""Build a step function that captures the scope config and returns a pure step(state, actions) callable."""`
       After: `"""Build a pure step(state, actions) callable that captures scope_config."""`

    5. **For complex functions (>30 lines, multiple branches), keep meaningful docstrings.** Trim boilerplate sections but preserve explanations of non-obvious behavior.

    6. **Do NOT remove docstrings entirely unless they say nothing beyond the function name.**

    **Specific guidance by file:**

    `cogrid/core/step_pipeline.py` (7 functions with Args/Returns):
    - `_backend_rng`: Keep explanation of what it does (splits JAX key vs numpy Generator) but remove Args that restate params
    - `envstate_to_dict`: Remove Args section (params are obvious from signature), keep one-line summary
    - `step`: This is a critical function. Keep the high-level description of the pipeline stages. Remove Args that restate params. Keep Returns if it explains the tuple structure.
    - `reset`: Same as step -- keep pipeline description, remove boilerplate Args
    - `build_step_fn` / `build_reset_fn`: Keep explanation that these capture scope_config at init time. Remove Args that restate.

    `cogrid/core/autowire.py` (3 functions):
    - These are complex composition functions. Keep explanations of what they compose. Remove Args that restate.

    `cogrid/envs/overcooked/array_config.py` (8 functions):
    - Complex domain logic. Keep explanations of pot mechanics, interaction rules. Remove boilerplate Args.
    - `overcooked_interaction_body`: Keep the explanation of the dispatch structure. Remove verbose Args.

    `cogrid/envs/overcooked/array_rewards.py` (4 functions):
    - Keep reward semantics (what triggers reward, how it's computed). Remove Args that restate params.

    `cogrid/core/agent.py` (2 functions):
    - `create_agent_arrays`: Keep explanation of what arrays are created and sentinel values. Remove boilerplate.
    - `sync_arrays_to_agents`: Keep explanation of direction (arrays -> Agent objects). Remove boilerplate.

    `cogrid/core/grid_object_registry.py` (3 functions):
    - `register_object_type`: Keep explanation of decorator behavior. Remove Args.
    - `build_lookup_tables`: Keep explanation of what tables are built. Remove Args.

    `cogrid/feature_space/array_features.py` (6 functions):
    - Feature functions have clear names. Remove Args that restate params. Keep any explanation of output shape or encoding.

    `cogrid/cogrid_env.py` (5 functions):
    - `set_terminated_fn`, `_build_layout_arrays`, `_build_pipeline`: Remove Args sections
    - `get_state` / `set_state`: Keep explanation of serialization format if non-obvious. Remove boilerplate.
    - `jax_step` / `jax_reset`: Keep explanation of JIT semantics. Remove Args.

    `cogrid/backend/_dispatch.py` (2 functions):
    - `set_backend`: Keep explanation of when this must be called. Remove Args.
    - `get_backend`: Keep explanation of return values. Remove Args if trivial.

    `cogrid/backend/env_state.py` (1 function):
    - `create_env_state`: Keep explanation of the pytree structure. Remove boilerplate Args.

    All other files: Apply the same rules. Read each docstring, remove boilerplate, keep substance.

    **Do NOT touch:**
    - Test file docstrings (leave as-is for test documentation)
    - Benchmark file docstrings (leave as-is)
    - Class-level docstrings (only trim function/method docstrings)
    - Module-level docstrings

    IMPORTANT: Do NOT modify any code logic. Only modify docstrings. Do NOT modify test assertions.
  </action>
  <verify>
    Run: `python3 -m pytest cogrid/tests/ -x -q --tb=short` -- all 126+ tests pass.
    Run: `python3 -m pytest cogrid/test_overcooked_env.py -x -q --tb=short` -- all 5 tests pass.

    Spot-check: Read 5 random trimmed docstrings and verify they add value beyond the signature.
  </verify>
  <done>No production docstring restates what the function signature already says. All Args/Returns sections either add non-obvious information or are removed. All tests pass unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Final test parity verification and diff audit</name>
  <files>(no files modified -- verification only)</files>
  <action>
    Run the complete test suite and verify the Phase 24 success criteria.

    1. Run the full test suite:
       `python3 -m pytest cogrid/tests/ cogrid/test_overcooked_env.py cogrid/envs/overcooked/test_interactions.py -v --tb=short`
       Confirm 126+ tests pass (the 5 overcooked env tests may fail when run in the same session as JAX tests due to pre-existing backend pollution -- this is a known issue documented in STATE.md, not a regression).

    2. Run overcooked env tests in isolation to confirm they pass:
       `python3 -m pytest cogrid/test_overcooked_env.py -v --tb=short`
       All 5 must pass.

    3. Verify zero stale TODOs:
       `grep -rn "TODO" --include="*.py" cogrid/`
       Must return zero results.

    4. Verify zero PHASE2 comments:
       `grep -rn "PHASE2" --include="*.py" cogrid/`
       Must return zero results.

    5. Verify zero unused imports (run the detection script from Plan 01 verify).

    6. Verify zero commented-out code blocks of 4+ lines.

    7. Verify no boilerplate docstrings remain:
       Run the docstring detection script -- the count of Args/Returns docstrings should be significantly reduced (target: only docstrings that add genuine value beyond the signature).

    If any check fails, diagnose and fix the issue (but do NOT modify test assertions).
  </action>
  <verify>
    All 7 checks above pass. The exact test count and pass/fail output is captured in the summary.
  </verify>
  <done>
    CLNP-01: Zero stale TODOs. CLNP-02: Zero dead code. CLNP-03: Docstrings trimmed to essentials. CLNP-04: Full test suite passes with zero assertion modifications. Phase 24 complete.
  </done>
</task>

</tasks>

<verification>
1. `python3 -m pytest cogrid/tests/ -v --tb=short` -- 126+ tests pass
2. `python3 -m pytest cogrid/test_overcooked_env.py -v --tb=short` -- 5 tests pass
3. `grep -rn "TODO" --include="*.py" cogrid/` -- zero results
4. `grep -rn "PHASE2" --include="*.py" cogrid/` -- zero results
5. Unused import detector -- zero results (excluding noqa)
6. Docstring boilerplate detector shows significant reduction from 59 functions
</verification>

<success_criteria>
- CLNP-03 satisfied: docstrings trimmed to essential information
- CLNP-04 confirmed: full test suite passes with zero modifications to assertions
- All four Phase 24 requirements (CLNP-01 through CLNP-04) met
- v1.4 milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/24-cleanup-pass/24-02-SUMMARY.md`
</output>
