---
phase: 28-automated-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/ci.yml
  - pyproject.toml
  - mkdocs.yml
autonomous: true

must_haves:
  truths:
    - "mkdocs build --strict succeeds locally without warnings"
    - "CI docs job validates documentation on every push and PR"
    - "CI coverage job runs pytest with coverage and reports results"
    - "pytest-cov is listed as a dev dependency in pyproject.toml"
    - "Coverage configuration uses relative_files for correct path mapping"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "docs and coverage CI jobs"
      contains: "mkdocs build --strict"
    - path: "pyproject.toml"
      provides: "pytest-cov dependency and coverage config"
      contains: "pytest-cov"
    - path: "mkdocs.yml"
      provides: "validation config for strict mode"
      contains: "validation:"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "pyproject.toml"
      via: "pip install -e .[dev] installs pytest-cov"
      pattern: "pip install.*dev"
    - from: ".github/workflows/ci.yml"
      to: "mkdocs.yml"
      via: "mkdocs build --strict reads validation config"
      pattern: "mkdocs build --strict"
---

<objective>
Add docs validation and coverage reporting jobs to CI.

Purpose: Catch broken documentation links before merge and track test coverage with a badge-ready reporting system.
Output: Extended ci.yml with docs and coverage jobs, pytest-cov in dev dependencies, coverage config in pyproject.toml, validation config in mkdocs.yml.
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-automated-deployment/28-RESEARCH.md
@.github/workflows/ci.yml
@pyproject.toml
@mkdocs.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add coverage config and pytest-cov dependency</name>
  <files>pyproject.toml, mkdocs.yml</files>
  <action>
In pyproject.toml:
1. Add `"pytest-cov>=4.0"` to the `[project.optional-dependencies] dev` list (after `"pytest>=7.0"`).
2. Add a `[tool.coverage.run]` section with:
   - `source = ["cogrid"]`
   - `relative_files = true`
   - `omit = ["cogrid/tests/*", "cogrid/benchmarks/*"]`
3. Add a `[tool.coverage.report]` section with:
   - `show_missing = true`
   - `skip_empty = true`

In mkdocs.yml:
4. Add a `validation:` top-level section (after `plugins:`) with:
```yaml
validation:
  nav:
    omitted_files: warn
    not_found: warn
    absolute_links: warn
  links:
    not_found: warn
    anchors: warn
    absolute_links: warn
    unrecognized_links: warn
```
5. Run `mkdocs build --strict` locally to verify no warnings. If warnings appear, fix them (common issues: missing nav entries, broken cross-references, mkdocstrings import failures). Iterate until `mkdocs build --strict` exits 0.
  </action>
  <verify>
- `pip install -e ".[dev]"` installs pytest-cov (check with `pip show pytest-cov`)
- `mkdocs build --strict` exits 0 with no warnings treated as errors
- `pytest --cov=cogrid --cov-report=term` runs and produces a coverage summary
  </verify>
  <done>pytest-cov in dev deps, coverage config in pyproject.toml, validation config in mkdocs.yml, mkdocs build --strict passes cleanly</done>
</task>

<task type="auto">
  <name>Task 2: Add docs and coverage jobs to CI workflow</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Add two new jobs to .github/workflows/ci.yml (alongside existing lint, test, test-jax jobs -- no `needs` dependencies, they run in parallel):

1. **docs** job:
```yaml
  docs:
    name: Docs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
          cache-dependency-path: pyproject.toml
      - run: pip install -e ".[docs]"
      - run: mkdocs build --strict
```

2. **coverage** job:
```yaml
  coverage:
    name: Coverage
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
          cache-dependency-path: pyproject.toml
      - run: pip install -e ".[dev]"
      - run: pytest --cov=cogrid --cov-report=xml --cov-report=term
      - uses: py-cov-action/python-coverage-comment-action@v3
        with:
          GITHUB_TOKEN: ${{ github.token }}
```

Keep the existing lint, test, and test-jax jobs unchanged. All 5 jobs run in parallel (no `needs` dependencies), consistent with the Phase 26 decision.
  </action>
  <verify>
- `ci.yml` contains 5 jobs: lint, test, test-jax, docs, coverage
- YAML syntax is valid (no indentation errors)
- docs job installs `.[docs]` and runs `mkdocs build --strict`
- coverage job installs `.[dev]`, runs pytest with `--cov`, and uses `py-cov-action/python-coverage-comment-action@v3`
- coverage job has `permissions: pull-requests: write` and `contents: write`
  </verify>
  <done>CI workflow has docs validation and coverage reporting jobs running in parallel with existing jobs</done>
</task>

</tasks>

<verification>
1. `mkdocs build --strict` exits 0 locally
2. `pytest --cov=cogrid --cov-report=term` produces coverage output locally
3. ci.yml has 5 parallel jobs: lint, test, test-jax, docs, coverage
4. pyproject.toml has [tool.coverage.run] and [tool.coverage.report] sections
5. mkdocs.yml has validation: section
</verification>

<success_criteria>
CI is extended with docs validation (mkdocs build --strict) and coverage reporting (pytest-cov + py-cov-action) jobs, both running in parallel with existing jobs. Coverage config and pytest-cov dependency are properly configured.
</success_criteria>

<output>
After completion, create `.planning/phases/28-automated-deployment/28-01-SUMMARY.md`
</output>
