---
phase: 28-automated-deployment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/docs.yml
  - .github/workflows/publish.yml
  - README.md
  - docs/conf.py
  - docs/Makefile
  - docs/make.bat
  - docs/index.rst
  - docs/content/cogrid_env.rst
  - docs/content/custom_env.rst
  - docs/content/examples.rst
  - docs/content/getting_started.rst
  - docs/_static/images/cogrid_logo.png
  - docs/_static/images/cogrid_logo_nobg.png
  - docs/_static/images/overcooked_grid.png
  - docs/_static/images/search_rescue_grid.png
  - docs/_static/images/sr_example.gif
autonomous: true

must_haves:
  truths:
    - "Docs deploy workflow triggers on push to main and runs mkdocs gh-deploy --force"
    - "PyPI publish workflow triggers on GitHub Release and uses OIDC trusted publishers"
    - "Old Sphinx config files and RST source files are removed from the repository"
    - "README images reference docs/assets/images/ paths (not docs/_static/images/)"
    - "README includes a coverage badge"
  artifacts:
    - path: ".github/workflows/docs.yml"
      provides: "GitHub Pages deployment on push to main"
      contains: "mkdocs gh-deploy --force"
    - path: ".github/workflows/publish.yml"
      provides: "PyPI publishing on GitHub Release via OIDC"
      contains: "pypa/gh-action-pypi-publish"
    - path: "README.md"
      provides: "Updated image paths and coverage badge"
      contains: "docs/assets/images/"
  key_links:
    - from: ".github/workflows/docs.yml"
      to: "mkdocs.yml"
      via: "mkdocs gh-deploy reads mkdocs.yml"
      pattern: "mkdocs gh-deploy"
    - from: ".github/workflows/publish.yml"
      to: "pyproject.toml"
      via: "python -m build reads pyproject.toml"
      pattern: "python -m build"
---

<objective>
Create deployment workflows and clean up legacy Sphinx infrastructure.

Purpose: Automate docs deployment to GitHub Pages and package publishing to PyPI. Remove old Sphinx files now that MkDocs migration is complete.
Output: Two new workflow files (docs.yml, publish.yml), cleaned-up repository (no Sphinx files), updated README with correct image paths and coverage badge.
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-automated-deployment/28-RESEARCH.md
@pyproject.toml
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs deploy and PyPI publish workflows</name>
  <files>.github/workflows/docs.yml, .github/workflows/publish.yml</files>
  <action>
Create `.github/workflows/docs.yml`:
```yaml
name: Deploy Docs

on:
  push:
    branches: [main]

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Configure Git Credentials
        run: |
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - run: echo "cache_id=$(date --utc '+%V')" >> $GITHUB_ENV
      - uses: actions/cache@v4
        with:
          key: mkdocs-material-${{ env.cache_id }}
          path: ~/.cache
          restore-keys: |
            mkdocs-material-
      - run: pip install -e ".[docs]"
      - run: mkdocs gh-deploy --force
```

Create `.github/workflows/publish.yml`:
```yaml
name: Publish to PyPI

on:
  release:
    types: [published]

jobs:
  build:
    name: Build distribution
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - run: pip install build
      - run: python -m build
      - uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist/

  publish:
    name: Publish to PyPI
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: pypi
      url: https://pypi.org/p/cogrid
    permissions:
      id-token: write
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: dist
          path: dist/
      - uses: pypa/gh-action-pypi-publish@release/v1
```

Note: The publish workflow requires two manual configurations before it will succeed:
1. PyPI Trusted Publisher: On pypi.org -> cogrid -> Publishing -> Add publisher: repo `chasemcd/cogrid`, workflow `publish.yml`, environment `pypi`
2. GitHub Environment: In repo Settings -> Environments, create a `pypi` environment
These are documented blockers (see STATE.md), not workflow bugs.
  </action>
  <verify>
- `.github/workflows/docs.yml` exists with `on: push: branches: [main]` and `mkdocs gh-deploy --force`
- `.github/workflows/publish.yml` exists with `on: release: types: [published]` and `pypa/gh-action-pypi-publish@release/v1`
- publish.yml has separate build and publish jobs (build uploads artifact, publish downloads it)
- publish.yml publish job has `permissions: id-token: write` and `environment: name: pypi`
- YAML syntax is valid for both files
  </verify>
  <done>Docs deploy and PyPI publish workflows created with correct triggers, permissions, and action versions</done>
</task>

<task type="auto">
  <name>Task 2: Remove Sphinx files and update README</name>
  <files>README.md, docs/conf.py, docs/Makefile, docs/make.bat, docs/index.rst, docs/content/cogrid_env.rst, docs/content/custom_env.rst, docs/content/examples.rst, docs/content/getting_started.rst, docs/_static/images/cogrid_logo.png, docs/_static/images/cogrid_logo_nobg.png, docs/_static/images/overcooked_grid.png, docs/_static/images/search_rescue_grid.png, docs/_static/images/sr_example.gif</files>
  <action>
1. Remove all old Sphinx tracked files via `git rm`:
```
git rm docs/conf.py docs/Makefile docs/make.bat docs/index.rst
git rm docs/content/cogrid_env.rst docs/content/custom_env.rst docs/content/examples.rst docs/content/getting_started.rst
git rm docs/_static/images/cogrid_logo.png docs/_static/images/cogrid_logo_nobg.png docs/_static/images/overcooked_grid.png docs/_static/images/search_rescue_grid.png docs/_static/images/sr_example.gif
```

2. If `docs/content/` and `docs/_static/` directories are now empty (they should be after removing all tracked files), they will be gone from git tracking automatically.

3. Update README.md image paths:
   - Change `docs/_static/images/cogrid_logo_nobg.png` to `docs/assets/images/cogrid_logo_nobg.png`
   - Change `docs/_static/images/sr_example.gif` to `docs/assets/images/sr_example.gif`

4. Add coverage badge to README.md badge section (after the existing License badge line):
```markdown
[![Coverage](https://raw.githubusercontent.com/chasemcd/cogrid/python-coverage-comment-action-data/badge.svg)](https://htmlpreview.github.io/?https://github.com/chasemcd/cogrid/blob/python-coverage-comment-action-data/htmlcov/index.html)
```
Note: This badge will show a broken image until the first CI run creates the `python-coverage-comment-action-data` branch. This is expected behavior.

5. Optionally remove the `docs/_build/` line from `.gitignore` (it was for Sphinx build output, now irrelevant). This is cosmetic -- harmless to leave.
  </action>
  <verify>
- `git ls-files docs/conf.py docs/Makefile docs/make.bat docs/index.rst docs/content/ docs/_static/` returns empty (all Sphinx files removed from tracking)
- README.md contains `docs/assets/images/cogrid_logo_nobg.png` (not `docs/_static/images/`)
- README.md contains `docs/assets/images/sr_example.gif` (not `docs/_static/images/`)
- README.md contains a coverage badge line with `python-coverage-comment-action-data`
  </verify>
  <done>All Sphinx files removed from git tracking, README image paths updated to MkDocs locations, coverage badge added to README</done>
</task>

</tasks>

<verification>
1. `ls .github/workflows/` shows ci.yml, docs.yml, publish.yml
2. `git ls-files docs/conf.py docs/index.rst docs/content/ docs/_static/` returns empty
3. README.md references `docs/assets/images/` (not `docs/_static/images/`)
4. docs.yml triggers on push to main; publish.yml triggers on release published
5. publish.yml uses OIDC (id-token: write, no PYPI_TOKEN secret)
</verification>

<success_criteria>
Docs deployment and PyPI publishing workflows are ready. Old Sphinx infrastructure is removed. README image paths point to MkDocs assets directory and include a coverage badge.
</success_criteria>

<output>
After completion, create `.planning/phases/28-automated-deployment/28-02-SUMMARY.md`
</output>
