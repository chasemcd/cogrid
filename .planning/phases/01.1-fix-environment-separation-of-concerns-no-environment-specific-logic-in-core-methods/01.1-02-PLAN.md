---
phase: 01.1-fix-environment-separation-of-concerns
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - cogrid/envs/overcooked/array_rewards.py
  - cogrid/envs/overcooked/test_interactions.py
autonomous: true

must_haves:
  truths:
    - "Overcooked array reward functions are importable from cogrid.envs.overcooked.array_rewards"
    - "compose_rewards utility remains importable from cogrid.core.array_rewards"
    - "Overcooked interaction parity test function is importable from cogrid.envs.overcooked.test_interactions"
    - "All parity tests still pass when run from new locations"
  artifacts:
    - path: "cogrid/envs/overcooked/array_rewards.py"
      provides: "Overcooked-specific array reward functions"
      contains: "delivery_reward_array"
    - path: "cogrid/envs/overcooked/test_interactions.py"
      provides: "Overcooked interaction parity test"
      contains: "test_interaction_parity"
  key_links:
    - from: "cogrid/envs/overcooked/array_rewards.py"
      to: "cogrid/core/agent.py"
      via: "get_dir_vec_table import"
      pattern: "from cogrid.core.agent import get_dir_vec_table"
---

<objective>
Move Overcooked-specific array reward functions from `cogrid/core/array_rewards.py` to `cogrid/envs/overcooked/array_rewards.py`, and move the Overcooked interaction parity test from `cogrid/core/interactions.py` to `cogrid/envs/overcooked/test_interactions.py`.

Purpose: Remove environment-specific code from core modules. The reward functions are 100% Overcooked-specific (reference pot, onion_soup, delivery_zone types). The test function imports Overcooked objects and tests Overcooked scenarios.

Output: New Overcooked-scoped files with moved code; core files stripped of Overcooked-specific content.
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.1-fix-environment-separation-of-concerns-no-environment-specific-logic-in-core-methods/01.1-RESEARCH.md
@cogrid/core/array_rewards.py
@cogrid/core/interactions.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move Overcooked reward functions and interaction test to envs/overcooked/</name>
  <files>
    cogrid/envs/overcooked/array_rewards.py
    cogrid/envs/overcooked/test_interactions.py
    cogrid/core/array_rewards.py
    cogrid/core/interactions.py
  </files>
  <action>
**Step A: Create `cogrid/envs/overcooked/array_rewards.py`**

Move the three Overcooked-specific reward functions from `cogrid/core/array_rewards.py`:
- `delivery_reward_array()`
- `onion_in_pot_reward_array()`
- `soup_in_dish_reward_array()`
- `_find_pot_index()` helper

Copy them VERBATIM (same signatures, same logic, same docstrings). Add appropriate module docstring noting these are Overcooked-specific array rewards.

Import dependencies: `from cogrid.core.agent import get_dir_vec_table`.

**Step B: Update `cogrid/core/array_rewards.py`**

Remove the three Overcooked-specific reward functions and `_find_pot_index()`. Keep ONLY the generic `compose_rewards()` function, which is environment-agnostic (it just calls whatever `fn` is in the config).

Add backward-compatible re-exports at the bottom of the file so any existing imports don't break during the transition:
```python
# Backward-compatible re-exports (moved to cogrid.envs.overcooked.array_rewards)
# TODO: Remove after Phase 01.1 Plan 03 completes wiring
from cogrid.envs.overcooked.array_rewards import (
    delivery_reward_array,
    onion_in_pot_reward_array,
    soup_in_dish_reward_array,
)
```

**Step C: Create `cogrid/envs/overcooked/test_interactions.py`**

Move the entire `test_interaction_parity()` function from `cogrid/core/interactions.py` (lines 424-729) to this new file. Copy VERBATIM including all imports it needs. The function should remain a standalone callable:
```python
"""Overcooked interaction parity tests.

Moved from cogrid/core/interactions.py. These tests validate that array-based
Overcooked interactions match the object-based implementation.

Run with:
    python -c "from cogrid.envs.overcooked.test_interactions import test_interaction_parity; test_interaction_parity()"
"""
```

**Step D: Remove `test_interaction_parity()` from `cogrid/core/interactions.py`**

Delete the entire function (the `# DEV: Remove or move to test suite after integration` comment and the `def test_interaction_parity():` function body, lines 424-729). Keep everything else in the file unchanged.

CRITICAL: Do NOT modify the functional code in `process_interactions_array()`, `_place_on_pot()`, `_place_on_non_pot()`, `tick_objects_array()`, or `build_interaction_tables()` in `core/interactions.py`. Those are Plan 03's job. Only remove the test function.
  </action>
  <verify>
1. Verify new reward functions are importable:
```bash
python -c "from cogrid.envs.overcooked.array_rewards import delivery_reward_array, onion_in_pot_reward_array, soup_in_dish_reward_array; print('New location imports: OK')"
```

2. Verify backward-compatible re-exports still work:
```bash
python -c "from cogrid.core.array_rewards import delivery_reward_array, compose_rewards; print('Backward compat imports: OK')"
```

3. Verify moved test passes from new location:
```bash
python -c "from cogrid.envs.overcooked.test_interactions import test_interaction_parity; test_interaction_parity()"
```
Expected: "ALL PARITY TESTS PASSED"

4. Verify core interactions.py no longer has test function:
```bash
python -c "import inspect; from cogrid.core import interactions; assert not hasattr(interactions, 'test_interaction_parity'), 'Should be removed'; print('Test removed from core: OK')"
```

5. Existing tests still pass: `python -m pytest cogrid/ -x -q --tb=short 2>&1 | tail -5`
  </verify>
  <done>
Overcooked array reward functions live in `cogrid/envs/overcooked/array_rewards.py`. `cogrid/core/array_rewards.py` contains only generic `compose_rewards()` plus backward-compatible re-exports. Overcooked interaction parity test lives in `cogrid/envs/overcooked/test_interactions.py`. The test function is removed from `cogrid/core/interactions.py`. All parity tests pass from new locations.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from cogrid.envs.overcooked.array_rewards import delivery_reward_array; print('OK')"` -- new location works
2. `python -c "from cogrid.core.array_rewards import delivery_reward_array; print('OK')"` -- backward compat works
3. `python -c "from cogrid.envs.overcooked.test_interactions import test_interaction_parity; test_interaction_parity()"` -- parity tests pass
4. `python -c "from cogrid.core.array_rewards import compose_rewards; print('compose_rewards still in core: OK')"` -- generic utility stays in core
</verification>

<success_criteria>
- Three Overcooked reward functions exist in `cogrid/envs/overcooked/array_rewards.py`
- `compose_rewards()` remains in `cogrid/core/array_rewards.py` (it is generic)
- Backward-compatible re-exports prevent import breakage
- Test function removed from `cogrid/core/interactions.py`
- Test function works from `cogrid/envs/overcooked/test_interactions.py`
- All parity tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-fix-environment-separation-of-concerns-no-environment-specific-logic-in-core-methods/01.1-02-SUMMARY.md`
</output>
